<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ó–∞–ø–∏—Å—å –∫ —Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥—É</title>
    <style>
        /* --- –°–¢–ò–õ–ò (–û—Å—Ç–∞–ª–∏—Å—å –ø–æ—á—Ç–∏ —Ç–µ –∂–µ) --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        /* –õ–æ–≥–æ—Ç–∏–ø */
        .logo-container { display: flex; justify-content: center; margin-bottom: 15px; }
        .logo { width: 100px; height: 100px; object-fit: cover; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        .header { text-align: center; margin-bottom: 25px; }
        .header h1 { font-size: 22px; margin-bottom: 5px; margin-top: 0; }
        .header p { color: var(--tg-theme-hint-color, #888); margin: 0; font-size: 14px; }

        /* –£—Å–ª—É–≥–∏ */
        .services-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .service-card {
            background-color: var(--tg-theme-secondary-bg-color, #f5f5f5);
            border: 2px solid transparent; border-radius: 12px; padding: 15px;
            cursor: pointer; text-align: center; transition: all 0.2s ease;
        }
        .service-card .icon { font-size: 32px; display: block; margin-bottom: 10px; }
        .service-card .title { font-weight: bold; font-size: 14px; display: block; }
        .service-card .price { font-size: 12px; opacity: 0.8; }
        .service-card.selected { border-color: var(--tg-theme-button-color, #2481cc); background-color: rgba(36, 129, 204, 0.1); }

        /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 14px; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω–ø—É—Ç–æ–≤ –∏ –Ω–æ–≤–æ–≥–æ SELECT */
        input, textarea, select {
            width: 100%; padding: 12px; box-sizing: border-box;
            border: 1px solid var(--tg-theme-hint-color, #ccc);
            border-radius: 8px; background-color: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #000);
            font-size: 16px; outline: none;
            /* –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Å—Ç—Ä–µ–ª–∫—É select –Ω–∞ –∞–π—Ñ–æ–Ω–∞—Ö –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã */
            -webkit-appearance: none; appearance: none;
        }
        input:focus, select:focus, textarea:focus { border-color: var(--tg-theme-button-color, #2481cc); }

    </style>
</head>
<body>

    <!-- –õ–û–ì–û–¢–ò–ü -->
    <div class="logo-container">
        <img src="https://cdn-icons-png.flaticon.com/512/3004/3004458.png" alt="–õ–æ–≥–æ" class="logo">
    </div>

    <div class="header">
        <h1 id="greeting">–ü—Ä–∏–≤–µ—Ç! üëã</h1>
        <p>–ó–∞–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –ø—Ä–∏–µ–º</p>
    </div>

    <!-- –£–°–õ–£–ì–ò -->
    <h3>1. –í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É:</h3>
    <div class="services-grid">
        <div class="service-card" onclick="selectService('consultation', 0)">
            <span class="icon">ü©∫</span><span class="title">–û—Å–º–æ—Ç—Ä</span><span class="price">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
        </div>
        <div class="service-card" onclick="selectService('caries', 3000)">
            <span class="icon">ü¶∑</span><span class="title">–õ–µ—á–µ–Ω–∏–µ</span><span class="price">–æ—Ç 3000‚ÇΩ</span>
        </div>
        <div class="service-card" onclick="selectService('cleaning', 5000)">
            <span class="icon">‚ú®</span><span class="title">–ß–∏—Å—Ç–∫–∞</span><span class="price">5000‚ÇΩ</span>
        </div>
        <div class="service-card" onclick="selectService('whitening', 10000)">
            <span class="icon">üíé</span><span class="title">–û—Ç–±–µ–ª–∏—Ç—å</span><span class="price">10000‚ÇΩ</span>
        </div>
    </div>

    <!-- –î–ê–¢–ê -->
    <h3>2. –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è:</h3>
    <div class="form-group">
        <label>–î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞:</label>
        <input type="date" id="date-input">
    </div>

    <!-- –í–†–ï–ú–Ø (–¢–ï–ü–ï–†–¨ –≠–¢–û –í–´–ü–ê–î–ê–Æ–©–ò–ô –°–ü–ò–°–û–ö) -->
    <div class="form-group">
        <label>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã (30 –º–∏–Ω):</label>
        <select id="time-select">
            <option value="" disabled selected>-- –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è --</option>
            <!-- –°—é–¥–∞ JavaScript –¥–æ–±–∞–≤–∏—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã: 09:00, 09:30... -->
        </select>
    </div>

    <!-- –ö–û–ù–¢–ê–ö–¢–´ -->
    <h3>3. –í–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã:</h3>
    <div class="form-group">
        <label>–í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω:</label>
        <input type="tel" id="phone-input" placeholder="+7 (999) ...">
    </div>
    
    <div class="form-group">
        <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
        <textarea id="comment-input" rows="2" placeholder="–ß—Ç–æ –±–µ—Å–ø–æ–∫–æ–∏—Ç?"></textarea>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        // --- –ù–ê–°–¢–†–û–ô–ö–ò ---
        const START_HOUR = 9;  // –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã (09:00)
        const END_HOUR = 20;   // –ö–æ–Ω–µ—Ü —Ä–∞–±–æ—Ç—ã (20:00)
        const STEP_MINUTES = 30; // –®–∞–≥ –∑–∞–ø–∏—Å–∏ (30 –º–∏–Ω—É—Ç)

        // 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function generateTimeSlots() {
            let select = document.getElementById('time-select');
            // –û—á–∏—â–∞–µ–º (–∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–≥–æ –ø—É–Ω–∫—Ç–∞)
            
            for (let hour = START_HOUR; hour < END_HOUR; hour++) {
                for (let min = 0; min < 60; min += STEP_MINUTES) {
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º 9 -> "09", 0 -> "00"
                    let hStr = String(hour).padStart(2, '0');
                    let mStr = String(min).padStart(2, '0');
                    let timeString = `${hStr}:${mStr}`;
                    
                    let option = document.createElement("option");
                    option.value = timeString;
                    option.text = timeString;
                    select.appendChild(option);
                }
            }
        }
        generateTimeSlots(); // –ó–∞–ø—É—Å–∫–∞–µ–º —Å—Ä–∞–∑—É

		// --- –£–ú–ù–ê–Ø –ó–ê–©–ò–¢–ê –î–ê–¢–´ ---

		// 1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã—á–∏—Å–ª—è–µ–º "—Å–µ–≥–æ–¥–Ω—è" –ø–æ –º–µ—Å—Ç–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ (–±–µ–∑ UTC —Å–¥–≤–∏–≥–æ–≤)
		let now = new Date();
		let year = now.getFullYear();
		let month = String(now.getMonth() + 1).padStart(2, '0');
		let day = String(now.getDate()).padStart(2, '0');
		let todayStr = `${year}-${month}-${day}`;

		// 2. –°—Ç–∞–≤–∏–º –∞—Ç—Ä–∏–±—É—Ç min (–¥–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É)
		let dateInput = document.getElementById("date-input");
		dateInput.setAttribute("min", todayStr);

		// 3. –î–æ–±–∞–≤–ª—è–µ–º "–ø–æ–ª–∏—Ü–µ–π—Å–∫–æ–≥–æ" –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
		dateInput.addEventListener('change', function() {
			// –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ –º–µ–Ω—å—à–µ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π
			if (this.value && this.value < todayStr) {
				tg.showPopup({
					title: '–û—à–∏–±–∫–∞ –¥–∞—Ç—ã',
					message: '–ù–µ–ª—å–∑—è –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ—à–µ–¥—à—É—é –¥–∞—Ç—É! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å–µ–≥–æ–¥–Ω—è –∏–ª–∏ –±—É–¥—É—â–∏–π –¥–µ–Ω—å.',
					buttons: [{type: 'ok'}]
				});
				this.value = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
				checkForm();     // –ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º—É (—á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É)
			} else {
				checkForm();     // –ï—Å–ª–∏ –≤—Å–µ –æ–∫ - –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
			}
		});


        // --- –õ–û–ì–ò–ö–ê ---
        let selectedService = null;
        let selectedPrice = 0;
        let user_name = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.first_name : "–ì–æ—Å—Ç—å";
        document.getElementById("greeting").innerText = `–ü—Ä–∏–≤–µ—Ç, ${user_name}! üëã`;

        tg.MainButton.textColor = "#FFFFFF";
        tg.MainButton.color = "#2cab37";

        function selectService(serviceName, price) {
            selectedService = serviceName;
            selectedPrice = price;
            document.querySelectorAll('.service-card').forEach(c => c.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            checkForm();
        }

        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        document.getElementById('date-input').addEventListener('change', checkForm);
        document.getElementById('time-select').addEventListener('change', checkForm); // –°–õ–£–®–ê–ï–ú –ù–û–í–´–ô –°–ï–õ–ï–ö–¢
        document.getElementById('phone-input').addEventListener('input', checkForm);

        function checkForm() {
            let date = document.getElementById('date-input').value;
            let time = document.getElementById('time-select').value; // –ë–ï–†–ï–ú –ó–ù–ê–ß–ï–ù–ò–ï –ò–ó –°–ü–ò–°–ö–ê
            let phone = document.getElementById('phone-input').value;

            if (selectedService && date && time && phone.length > 5) {
                tg.MainButton.text = `–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ ${time}`;
                tg.MainButton.show();
            } else {
                tg.MainButton.hide();
            }
        }

        Telegram.WebApp.onEvent('mainButtonClicked', function(){
            let data = {
                type: 'booking',
                service: selectedService,
                price: selectedPrice,
                date: document.getElementById('date-input').value,
                time: document.getElementById('time-select').value, // –û–¢–ü–†–ê–í–õ–Ø–ï–ú –í–´–ë–†–ê–ù–ù–´–ô –°–õ–û–¢
                phone: document.getElementById('phone-input').value,
                comment: document.getElementById('comment-input').value,
                user_name: user_name
            };
            tg.sendData(JSON.stringify(data));
        });
    </script>
</body>
</html>